# План реализации функций кнопок AI-обработки статей

## Цель
Реализовать три функции для обработки англоязычных статей с помощью OpenRouter AI:
- "О чем статья?" - генерация краткого резюме статьи
- "Тезисы" - извлечение основных тезисов статьи
- "Пост для Telegram" - создание поста для Telegram на основе статьи

## Текущее состояние
✅ Реализован парсинг статей (извлечение title, date, content)
✅ Реализован перевод статей через OpenRouter AI (модель Deepseek)
✅ Интерфейс с тремя кнопками создан (пока с мок-данными)
✅ Интеграция с OpenRouter API настроена

## Порядок действий

### Этап 1: Создание API route для AI-обработки

#### 1.1. Создать файл `app/api/ai-process/route.ts`
- Создать новый API route для обработки статей через AI
- Принимать параметры: `text` (текст статьи) и `action` (тип действия: 'summary', 'thesis', 'telegram')
- Использовать OpenRouter API с моделью Deepseek
- Возвращать результат обработки

#### 1.2. Реализовать логику для каждого типа действия:
- **"О чем статья?" (summary)**:
  - Системный промпт: "Ты эксперт по анализу статей. Напиши краткое резюме следующей статьи на русском языке (2-3 абзаца)."
  - Передать заголовок и контент статьи
  
- **"Тезисы" (thesis)**:
  - Системный промпт: "Ты эксперт по анализу статей. Извлеки основные тезисы из следующей статьи и представь их в виде нумерованного списка на русском языке. Каждый тезис должен быть кратким и содержательным."
  - Передать заголовок и контент статьи
  
- **"Пост для Telegram" (telegram)**:
  - Системный промпт: "Ты эксперт по созданию контента для социальных сетей. Создай пост для Telegram на основе следующей статьи. Пост должен быть: интересным, структурированным, с эмодзи, длиной 2-3 абзаца, на русском языке."
  - Передать заголовок и контент статьи

#### 1.3. Обработка ошибок:
- Проверка наличия API ключа
- Обработка ошибок от OpenRouter API
- Валидация входных данных
- Логирование ошибок

### Этап 2: Обновление интерфейса

#### 2.1. Обновить функцию `handleAction` в `app/page.tsx`:
- Убрать мок-данные (setTimeout)
- Реализовать реальный запрос к `/api/ai-process`
- Передавать распарсенные данные статьи (title и content)
- Передавать тип действия ('summary', 'thesis', 'telegram')
- Обрабатывать ответ и отображать результат

#### 2.2. Добавить проверки:
- Проверять наличие распарсенных данных перед вызовом AI
- Показывать сообщение, если статья не распарсена
- Обрабатывать ошибки и отображать их пользователю

#### 2.3. Улучшить UX:
- Показывать индикатор загрузки во время обработки
- Отображать активную кнопку во время обработки
- Форматировать результат в зависимости от типа действия

### Этап 3: Оптимизация и улучшения

#### 3.1. Оптимизация промптов:
- Протестировать промпты на разных статьях
- Настроить параметры модели (temperature, max_tokens)
- Улучшить системные промпты для лучших результатов

#### 3.2. Обработка длинных статей:
- Реализовать разбиение длинных статей на части
- Обрабатывать части последовательно или параллельно
- Объединять результаты

#### 3.3. Кэширование результатов:
- Сохранять результаты обработки в состоянии
- Позволить пользователю переключаться между результатами
- Избегать повторных запросов для одного и того же действия

### Этап 4: Тестирование

#### 4.1. Функциональное тестирование:
- Протестировать каждую кнопку на разных статьях
- Проверить обработку ошибок
- Проверить работу с разными форматами статей

#### 4.2. Тестирование производительности:
- Измерить время ответа API
- Оптимизировать запросы при необходимости
- Проверить работу с длинными статьями

#### 4.3. Тестирование UX:
- Проверить удобство использования интерфейса
- Убедиться, что индикаторы загрузки работают корректно
- Проверить отображение результатов

## Технические детали

### API Endpoint
- **URL**: `/api/ai-process`
- **Method**: `POST`
- **Body**: 
  ```json
  {
    "text": "текст статьи",
    "action": "summary" | "thesis" | "telegram"
  }
  ```

### OpenRouter API
- **Endpoint**: `https://openrouter.ai/api/v1/chat/completions`
- **Model**: `deepseek/deepseek-chat`
- **API Key**: `OPENROUTER_API_KEY` из `.env.local`

### Структура ответа
```json
{
  "result": "текст результата",
  "model": "deepseek/deepseek-chat",
  "usage": { ... }
}
```

## Зависимости
- OpenRouter API ключ должен быть настроен в `.env.local`
- Распарсенные данные статьи должны быть доступны в состоянии компонента
- Интерфейс должен быть готов к отображению результатов

## Примечания
- Все три функции используют одну и ту же модель AI (Deepseek)
- Разница только в системных промптах
- Результаты генерируются на русском языке
- Статья должна быть сначала распарсена перед использованием AI-функций

